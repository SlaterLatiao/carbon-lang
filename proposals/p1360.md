# Change raw string literal syntax: `[#]\*"` represents single-line string and `[#]\*'''` represents block string

<!--
Part of the Carbon Language project, under the Apache License v2.0 with LLVM
Exceptions. See /LICENSE for license information.
SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
-->

[Pull request](https://github.com/carbon-language/carbon-lang/pull/1360)

<!-- toc -->

## Table of contents

-   [Problem](#problem)
-   [Background](#background)
-   [Proposal](#proposal)
-   [Details](#details)
-   [Rationale](#rationale)
-   [Alternatives considered](#alternatives-considered)

<!-- tocstop -->

## Problem

Under current design of string literals, users may make assumptions that a
starting `[#]*"""` represents a block string and misunderstand the syntax.

## Background

The design of
[string literals](https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/lexical_conventions/string_literals.md)
specifies a block string literal to start with `[#]*"""`. Users may take for
granted the other way around, where any string literal starting with `[#]*"""`
is a block string literal. This does not hold true, however. Two counter-cases
are `"""abc"""` represents three tokens `""`, `"abc"` and `""`, and `#"""#`
which is equivalent to `"\""`. Neither is a block string literal and may be
visually confusing.

## Proposal

Interpret `[#]*"` as the start of single-line string literals, and `[#]*'''` as
the start of block string literals. Disallow adjacent string literals like
`"""abc"""`.

## Details

Users can easily distinguish single-line string literals from block string
literals with the proposed change. Confusion on `"""abc"""` will be eliminated
because adjacent string literals are invalid in the proposal. On the other hand,
`#"""#` will be clear to the user of representing `"\""`, as `"""` does not
represent a block string literal any more. More details can be found
[here](/docs/design/lexical_conventions/string_literals.md).

## Rationale

This principle helps make Carbon code
[easy to read, understand, and write](/docs/project/goals.md#code-that-is-easy-to-read-understand-and-write),
because it avoids confusion on the type of certain string literals.

## Alternatives considered

The
[current implementation](https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/lexical_conventions/string_literals.md)
is a considered alternative. Compared to this proposal, the current
implementation complicates the lexing. When the lexer sees `[#]+"""`, it
temporarily accepts syntax of both string types because the type of the string
is undecided. Specifically, it accepts vertical whitespaces even if they are not
allowed in single-line strings. The type of the string won't be decided until
the lexer sees a closing `"#` or a new line. In case of a closing `"#` where the
string is single-line, the lexer will look back on the scanned characters for
vertical whitespaces to decide if the single-line string is valid. The proposal
simplifies the lexing without losing the convenience provided by the current
implementation. For example, as discussed in
[issue #1359](https://github.com/carbon-language/carbon-lang/issues/1359),
`#"""#` is a natural way to write a string of `"`. This is also supported by the
proposal.

The [proposal for string literals](/proposals/p0199.md) copmared string literals
in different programming languages. C++ does not have the issue this PR trying
to address because the block string is represented by raw string. On the other
hand, its syntax is potentially complex. For example, `R"(")"` is no simpler
than `"\""`. Swift takes `#""""#` as
[valid simple string](https://sourcegraph.com/search?q=context:global+file:%5C.swift%24+%23%22%22%22%22%23&patternType=literal)
and the current implementation is inspired by it.
