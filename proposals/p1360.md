# Change raw string literal syntax: [#]\*""" always starts a block string

<!--
Part of the Carbon Language project, under the Apache License v2.0 with LLVM
Exceptions. See /LICENSE for license information.
SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
-->

[Pull request](https://github.com/carbon-language/carbon-lang/pull/1360)

<!-- toc -->

## Table of contents

-   [Problem](#problem)
-   [Background](#background)
-   [Proposal](#proposal)
-   [Details](#details)
-   [Rationale](#rationale)
-   [Alternatives considered](#alternatives-considered)

<!-- tocstop -->

## Problem

Under current design of string literals, users may make assumptions that a
starting `[#]*"""` represents a block string and misunderstand the syntax.

## Background

The design of
[string literals](https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/lexical_conventions/string_literals.md)
specifies a block string literal to start with `[#]*"""`. Users may take for
granted the other way around, where any string literal starting with `[#]*"""`
is a block string literal. This does not hold true, however. Two
counter-cases are `"""abc"""` represents three tokens `""`, `"abc"` and `""`,
and `#"""#` which is equlivent to `"\""`. Neither is a block string literal and
may be visually confusing.

## Proposal

Always interpret `[#]*"""` as the start of a block string literal, even if the result is invalid code.

## Details

Two changes are made in this proposal. First, `"""` always starts a simple block
string literal. Instead of the three tokens described above, `"""abc"""` will be
parsed as an invalid simple block string literal. Users can use extra spaces
like `"" "abc" ""` to represent the three tokens represented in the original
design. Second, `[#]+"""` always starts a raw block string literal.
`#"""abc"""#` becomes an invalid block string literal, compared to a valid
single-line string literal in the original design. More details can be found
[here](/docs/design/lexical_conventions/string_literals.md).

## Rationale

This principle helps make Carbon code
[easy to read, understand, and write](/docs/project/goals.md#code-that-is-easy-to-read-understand-and-write),
because it avoids confusion on the type of certain string literals.

## Alternatives considered

The
[current implementation](https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/lexical_conventions/string_literals.md)
is a considered alternative. Compared to this proposal, current implementation
does not compromise on the convenience of using raw string literals by not
requiring escaping of `"` that locates at the beginning of a single-line string
literal. For example, as discussed in
[issue #1359](https://github.com/carbon-language/carbon-lang/issues/1359),
`#"""#` is a natural way to write a string of `"`, but it becomes invalid with
this proposal.

On the other hand, the current implementation complicates the lexing. When the
lexer sees `[#]+"""`, it temporarily accepts syntax of both string types because
the type of the string is undecided. Specifically, it accepts vertical
whitespaces even if they are not allowed in single-line strings. The type of the
string won't be decided until the lexer sees a closing `"#` or a new line. In
case of a closing `"#` where the string is single-line, the lexer will look back
on the scanned characters for vertical whitespaces to decide if the single-line
string is valid.
